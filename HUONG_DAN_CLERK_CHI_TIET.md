# üîê H∆Ø·ªöNG D·∫™N THI·∫æT L·∫¨P CLERK.COM CHI TI·∫æT

## üìë M·ª§C L·ª§C
1. [Ph·∫ßn 1: Thi·∫øt l·∫≠p c∆° b·∫£n](#ph·∫ßn-1-thi·∫øt-l·∫≠p-c∆°-b·∫£n)
2. [Ph·∫ßn 2: C·∫•u h√¨nh n√¢ng cao](#ph·∫ßn-2-c·∫•u-h√¨nh-n√¢ng-cao)
3. [Ph·∫ßn 3: Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ Token Expiry (60 gi√¢y)](#ph·∫ßn-3-gi·∫£i-quy·∫øt-v·∫•n-ƒë·ªÅ-token-expiry)
4. [Ph·∫ßn 4: T·ªëi ∆∞u h√≥a Production](#ph·∫ßn-4-t·ªëi-∆∞u-h√≥a-production)

---

## üìå PH·∫¶N 1: THI·∫æT L·∫¨P C∆° B·∫¢N

### B∆∞·ªõc 1: T·∫°o t√†i kho·∫£n Clerk

1. **Truy c·∫≠p Clerk:**
   - V√†o https://clerk.com
   - Click **"Start building for free"** ho·∫∑c **"Sign up"**

2. **ƒêƒÉng k√Ω t√†i kho·∫£n:**
   - Ch·ªçn ƒëƒÉng k√Ω b·∫±ng **GitHub** (khuy·∫øn ngh·ªã) ho·∫∑c **Google**
   - Ho·∫∑c s·ª≠ d·ª•ng email th√¥ng th∆∞·ªùng
   - X√°c nh·∫≠n email n·∫øu c·∫ßn

3. **T·∫°o Application:**
   ```
   Application Name: Spotify Clone (ho·∫∑c t√™n b·∫°n mu·ªën)
   ```

### B∆∞·ªõc 2: C·∫•u h√¨nh Application

1. **Ch·ªçn ph∆∞∆°ng th·ª©c ƒëƒÉng nh·∫≠p:**
   - ‚úÖ **Email address** (khuy·∫øn ngh·ªã)
   - ‚úÖ **Google OAuth** (khuy·∫øn ngh·ªã cho UX t·ªët)
   - ‚ùå Phone number (t√πy ch·ªçn, t·ªën ph√≠)
   - ‚úÖ **Username** (t√πy ch·ªçn)

2. **C·∫•u h√¨nh Social Login (OAuth):**
   - Click v√†o **SSO Connections** trong sidebar
   - Ch·ªçn **Google**
   - Click **Enable**
   - Kh√¥ng c·∫ßn t·∫°o OAuth app ri√™ng, Clerk s·∫Ω t·ª± x·ª≠ l√Ω ·ªü m√¥i tr∆∞·ªùng development

### B∆∞·ªõc 3: L·∫•y API Keys

1. **V√†o API Keys:**
   - Sidebar ‚Üí **API Keys**
   - B·∫°n s·∫Ω th·∫•y 2 lo·∫°i keys:

   ```
   üìù PUBLISHABLE KEY (Public - an to√†n ƒë·ªÉ public)
   V√≠ d·ª•: pk_test_xxxxxxxxxxxxxxxxxxxxx
   
   üîê SECRET KEY (Private - TUY·ªÜT ƒê·ªêI kh√¥ng public)
   V√≠ d·ª•: sk_test_xxxxxxxxxxxxxxxxxxxxx
   ```

2. **Copy keys:**
   - Click v√†o icon **Copy** b√™n c·∫°nh m·ªói key
   - L∆∞u t·∫°m v√†o Notepad

### B∆∞·ªõc 4: T·∫°o file .env

#### üîπ Backend (.env trong folder backend/)

T·∫°o file `backend/.env`:

```bash
# MongoDB
MONGODB_URI=mongodb://localhost:27017/spotify-clone
# ho·∫∑c MongoDB Atlas
# MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/spotify-clone

# Cloudinary
CLOUDINARY_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

# Clerk - Backend
CLERK_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxxxxxxxxxxx
CLERK_SECRET_KEY=sk_test_xxxxxxxxxxxxxxxxxxxxx

# Admin
ADMIN_EMAIL=your-email@gmail.com

# Server
PORT=5000
NODE_ENV=development
```

#### üîπ Frontend (.env trong folder frontend/)

T·∫°o file `frontend/.env`:

```bash
# Clerk - Frontend
VITE_CLERK_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxxxxxxxxxxx

# Kh√¥ng c·∫ßn CLERK_SECRET_KEY ·ªü frontend!
```

‚ö†Ô∏è **L∆ØU √ù:** 
- Frontend ch·ªâ c·∫ßn `PUBLISHABLE_KEY`
- Backend c·∫ßn c·∫£ `PUBLISHABLE_KEY` v√† `SECRET_KEY`
- Kh√¥ng bao gi·ªù commit `.env` l√™n Git!

### B∆∞·ªõc 5: C√†i ƒë·∫∑t Dependencies (ƒë√£ c√≥ trong project)

C√°c package ƒë√£ ƒë∆∞·ª£c c√†i:

```json
// Frontend
"@clerk/clerk-react": "^5.14.0"

// Backend
"@clerk/express": "^1.3.4"
```

### B∆∞·ªõc 6: C·∫•u h√¨nh Clerk Provider trong Frontend

File `frontend/src/main.tsx` c·∫ßn wrap App v·ªõi ClerkProvider:

```typescript
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.tsx'
import './index.css'
import { ClerkProvider } from '@clerk/clerk-react'

const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!PUBLISHABLE_KEY) {
  throw new Error("Missing Clerk Publishable Key")
}

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <ClerkProvider publishableKey={PUBLISHABLE_KEY}>
      <App />
    </ClerkProvider>
  </React.StrictMode>,
)
```

---

## üìå PH·∫¶N 2: C·∫§U H√åNH N√ÇNG CAO

### B∆∞·ªõc 1: C·∫•u h√¨nh JWT Template (QUAN TR·ªåNG!)

ƒê√¢y l√† b∆∞·ªõc **C·ª∞C K·ª≤ QUAN TR·ªåNG** ƒë·ªÉ tr√°nh token expiry 60 gi√¢y!

1. **V√†o Dashboard Clerk:**
   - Sidebar ‚Üí **JWT Templates**
   - Click **+ New template**

2. **T·∫°o Custom Template:**
   ```
   Name: default
   Template type: Blank
   ```

3. **C·∫•u h√¨nh Claims:**
   
   Trong ph·∫ßn **Claims**, th√™m:
   ```json
   {
     "userId": "{{user.id}}",
     "email": "{{user.primary_email_address}}",
     "firstName": "{{user.first_name}}",
     "lastName": "{{user.last_name}}",
     "imageUrl": "{{user.image_url}}"
   }
   ```

4. **‚ö†Ô∏è C·∫§U H√åNH TOKEN LIFETIME (QUAN TR·ªåNG NH·∫§T):**
   
   Scroll xu·ªëng ph·∫ßn **Token Lifetime**:
   ```
   Session token lifetime: 3600 seconds (1 gi·ªù)
   ho·∫∑c: 86400 seconds (24 gi·ªù) - khuy·∫øn ngh·ªã cho development
   ```

   üìù **Gi·∫£i th√≠ch:**
   - M·∫∑c ƒë·ªãnh Clerk set lifetime = 60 gi√¢y (1 ph√∫t)
   - B·∫°n c·∫ßn tƒÉng l√™n √≠t nh·∫•t 3600 gi√¢y (1 gi·ªù)
   - Cho production: 3600-7200 gi√¢y (1-2 gi·ªù)
   - Cho development: 86400 gi·ªù (24 gi·ªù) ƒë·ªÉ d·ªÖ test

5. **C·∫•u h√¨nh Session:**
   - Sidebar ‚Üí **Sessions**
   - **Inactive lifetime**: 7 days (m·∫∑c ƒë·ªãnh)
   - **Maximum lifetime**: 7 days
   - **Multi-session handling**: Multiple sessions (cho ph√©p ƒëƒÉng nh·∫≠p nhi·ªÅu thi·∫øt b·ªã)

6. **Apply JWT Template:**
   - V√†o **API Keys**
   - T√¨m ph·∫ßn **Advanced**
   - Ch·ªçn **JWT Template**: `default` (template v·ª´a t·∫°o)
   - Click **Save**

### B∆∞·ªõc 2: C·∫•u h√¨nh Domains & URLs

1. **Development URLs:**
   
   V√†o **Paths** trong dashboard:
   ```
   Sign-in URL: /sign-in
   Sign-up URL: /sign-up
   After sign-in URL: /
   After sign-up URL: /auth-callback
   ```

2. **Allowed Origins (CORS):**
   
   V√†o **Settings** ‚Üí **Allowed origins**:
   ```
   Development:
   - http://localhost:3000
   - http://localhost:5000
   - http://127.0.0.1:3000
   ```

3. **Webhook URLs (T√πy ch·ªçn):**
   
   N·∫øu c·∫ßn sync user data:
   ```
   Endpoint: https://yourdomain.com/api/webhooks/clerk
   Events: user.created, user.updated
   ```

### B∆∞·ªõc 3: C·∫•u h√¨nh Email & Branding

1. **Email Templates:**
   - Sidebar ‚Üí **Email, SMS & Phone**
   - Customize email templates cho:
     - Verification email
     - Password reset
     - Welcome email

2. **Branding:**
   - Sidebar ‚Üí **Customization**
   - Upload logo c·ªßa b·∫°n
   - Ch·ªçn theme colors
   - Customize layout

---

## üìå PH·∫¶N 3: GI·∫¢I QUY·∫æT V·∫§N ƒê·ªÄ TOKEN EXPIRY

### V·∫•n ƒë·ªÅ: Token ch·ªâ live 60 gi√¢y

**Nguy√™n nh√¢n:**
1. JWT Template kh√¥ng ƒë∆∞·ª£c c·∫•u h√¨nh ƒë√∫ng
2. Token lifetime m·∫∑c ƒë·ªãnh = 60 gi√¢y
3. Kh√¥ng c√≥ c∆° ch·∫ø refresh token t·ª± ƒë·ªông

### ‚úÖ Gi·∫£i ph√°p 1: TƒÉng Token Lifetime (ƒê√£ l√†m ·ªü Ph·∫ßn 2)

Xem l·∫°i **Ph·∫ßn 2 ‚Üí B∆∞·ªõc 1 ‚Üí B∆∞·ªõc 4** ƒë·ªÉ c·∫•u h√¨nh l·∫°i.

### ‚úÖ Gi·∫£i ph√°p 2: Implement Token Refresh (Project c·ªßa b·∫°n ƒë√£ c√≥!)

D·ª± √°n c·ªßa b·∫°n ƒë√£ implement s·∫µn c∆° ch·∫ø refresh token t·ª± ƒë·ªông trong file:

**`frontend/src/lib/axios.ts`** - Response Interceptor:
```typescript
axiosInstance.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;
    
    // N·∫øu g·∫∑p 401 v√† ch∆∞a retry
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      
      // L·∫•y token m·ªõi t·ª´ Clerk
      if (getTokenCallback) {
        const newToken = await getTokenCallback();
        
        if (newToken) {
          // C·∫≠p nh·∫≠t token m·ªõi v√†o axios headers
          axiosInstance.defaults.headers.common["Authorization"] = `Bearer ${newToken}`;
          originalRequest.headers["Authorization"] = `Bearer ${newToken}`;
          
          // Retry request v·ªõi token m·ªõi
          return axiosInstance(originalRequest);
        }
      }
    }
    
    return Promise.reject(error);
  }
);
```

**C√°ch ho·∫°t ƒë·ªông:**
1. Khi API tr·∫£ v·ªÅ l·ªói 401 (Unauthorized)
2. Interceptor t·ª± ƒë·ªông g·ªçi `getToken()` t·ª´ Clerk
3. Clerk SDK t·ª± ƒë·ªông refresh token (s·ª≠ d·ª•ng session token)
4. Token m·ªõi ƒë∆∞·ª£c set v√†o headers
5. Request ƒë∆∞·ª£c retry v·ªõi token m·ªõi

### ‚úÖ Gi·∫£i ph√°p 3: Proactive Token Refresh

Th√™m c∆° ch·∫ø refresh token tr∆∞·ªõc khi h·∫øt h·∫°n:

**T·∫°o file m·ªõi:** `frontend/src/hooks/useTokenRefresh.ts`

```typescript
import { useAuth } from '@clerk/clerk-react';
import { useEffect, useRef } from 'react';
import { axiosInstance } from '@/lib/axios';

export const useTokenRefresh = () => {
  const { getToken } = useAuth();
  const refreshIntervalRef = useRef<NodeJS.Timeout>();

  useEffect(() => {
    // Refresh token m·ªói 50 ph√∫t (tr∆∞·ªõc khi h·∫øt h·∫°n 60 ph√∫t)
    const refreshToken = async () => {
      try {
        const token = await getToken({ template: 'default' });
        if (token) {
          axiosInstance.defaults.headers.common['Authorization'] = `Bearer ${token}`;
          console.log('‚úÖ Token refreshed proactively');
        }
      } catch (error) {
        console.error('‚ùå Failed to refresh token:', error);
      }
    };

    // Refresh ngay l·∫≠p t·ª©c khi mount
    refreshToken();

    // Refresh m·ªói 50 ph√∫t
    refreshIntervalRef.current = setInterval(refreshToken, 50 * 60 * 1000);

    return () => {
      if (refreshIntervalRef.current) {
        clearInterval(refreshIntervalRef.current);
      }
    };
  }, [getToken]);
};
```

**S·ª≠ d·ª•ng trong** `frontend/src/providers/AuthProvider.tsx`:

```typescript
import { useTokenRefresh } from '@/hooks/useTokenRefresh';

const AuthProvider = ({ children }: { children: React.ReactNode }) => {
  // ... existing code ...
  
  // Th√™m d√≤ng n√†y
  useTokenRefresh();
  
  // ... rest of code ...
};
```

### ‚úÖ Gi·∫£i ph√°p 4: C·∫•u h√¨nh getToken() ƒë√∫ng c√°ch

Khi g·ªçi `getToken()`, lu√¥n truy·ªÅn `template` name:

```typescript
// ‚ùå SAI - s·ª≠ d·ª•ng template m·∫∑c ƒë·ªãnh (60s)
const token = await getToken();

// ‚úÖ ƒê√öNG - s·ª≠ d·ª•ng custom template
const token = await getToken({ template: 'default' });
```

**Update file** `frontend/src/providers/AuthProvider.tsx`:

```typescript
const initAuth = async () => {
  try {
    // Th√™m { template: 'default' }
    const token = await getToken({ template: 'default' });
    updateApiToken(token);
    // ... rest
  } catch (error) {
    // ...
  }
};
```

### ‚öôÔ∏è C·∫•u h√¨nh Backend Token Verification

File `backend/src/index.js` ƒë√£ c√≥:

```javascript
app.use(clerkMiddleware());
```

ƒê·ªÉ verify token ch√≠nh x√°c, c·∫•u h√¨nh th√™m:

```javascript
import { clerkMiddleware } from "@clerk/express";

app.use(
  clerkMiddleware({
    // T·ª± ƒë·ªông verify JWT token trong Authorization header
    secretKey: process.env.CLERK_SECRET_KEY,
    publishableKey: process.env.CLERK_PUBLISHABLE_KEY,
    
    // Cho ph√©p unauthenticated requests (middleware kh√¥ng block)
    // Ch·ªâ verify n·∫øu c√≥ token
    authorizedParties: undefined,
  })
);
```

---

## üìå PH·∫¶N 4: T·ªêI ∆ØU H√ìA PRODUCTION

### B∆∞·ªõc 1: Chuy·ªÉn sang Production Keys

Khi deploy l√™n production:

1. **T·∫°o Production Instance:**
   - Dashboard ‚Üí Top menu ‚Üí Switch to **Production**
   - Copy **Production API Keys**

2. **Update .env cho Production:**
   ```bash
   # Production keys (b·∫Øt ƒë·∫ßu v·ªõi pk_live v√† sk_live)
   CLERK_PUBLISHABLE_KEY=pk_live_xxxxxxxxxxxxxxxxxxxxx
   CLERK_SECRET_KEY=sk_live_xxxxxxxxxxxxxxxxxxxxx
   VITE_CLERK_PUBLISHABLE_KEY=pk_live_xxxxxxxxxxxxxxxxxxxxx
   ```

3. **C·∫•u h√¨nh Production Domains:**
   - **Allowed origins:**
     ```
     https://yourdomain.com
     https://www.yourdomain.com
     ```
   
   - **After sign-in URL:**
     ```
     https://yourdomain.com/auth-callback
     ```

### B∆∞·ªõc 2: Google OAuth Production Setup

Development: Clerk t·ª± x·ª≠ l√Ω
Production: C·∫ßn t·∫°o OAuth app ri√™ng

1. **T·∫°o Google OAuth App:**
   - V√†o https://console.cloud.google.com
   - **APIs & Services** ‚Üí **Credentials**
   - **Create Credentials** ‚Üí **OAuth 2.0 Client ID**
   
   ```
   Application type: Web application
   Name: Spotify Clone
   
   Authorized JavaScript origins:
   - https://yourdomain.com
   
   Authorized redirect URIs:
   - https://accounts.clerk.dev/v1/oauth_callback
   ```

2. **Copy Client ID v√† Secret:**
   - L∆∞u l·∫°i `Client ID` v√† `Client Secret`

3. **C·∫•u h√¨nh trong Clerk:**
   - Dashboard ‚Üí **SSO Connections** ‚Üí **Google**
   - Enable **Custom credentials**
   - Paste `Client ID` v√† `Client Secret`
   - Click **Save**

### B∆∞·ªõc 3: Rate Limiting & Security

1. **Implement Rate Limiting:**

T·∫°o file `backend/src/middleware/rateLimit.js`:

```javascript
import rateLimit from 'express-rate-limit';

export const apiLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 ph√∫t
  max: 100, // T·ªëi ƒëa 100 requests/15 ph√∫t
  message: 'Too many requests from this IP, please try again later.',
  standardHeaders: true,
  legacyHeaders: false,
});

export const authLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 5, // T·ªëi ƒëa 5 login attempts/15 ph√∫t
  message: 'Too many login attempts, please try again later.',
});
```

**Install package:**
```bash
cd backend
npm install express-rate-limit
```

**Apply trong** `backend/src/index.js`:

```javascript
import { apiLimiter, authLimiter } from './middleware/rateLimit.js';

app.use('/api/', apiLimiter);
app.use('/api/auth/', authLimiter);
```

2. **Security Headers:**

```bash
cd backend
npm install helmet
```

```javascript
import helmet from 'helmet';

app.use(helmet({
  contentSecurityPolicy: false, // T·∫Øt CSP n·∫øu g·∫∑p v·∫•n ƒë·ªÅ v·ªõi assets
}));
```

### B∆∞·ªõc 4: Monitoring & Logging

1. **Clerk Dashboard:**
   - **Users** ‚Üí Xem users ƒë√£ ƒëƒÉng k√Ω
   - **Sessions** ‚Üí Monitor active sessions
   - **Events** ‚Üí Track authentication events

2. **Backend Logging:**

```javascript
// backend/src/middleware/logger.js
export const requestLogger = (req, res, next) => {
  const start = Date.now();
  
  res.on('finish', () => {
    const duration = Date.now() - start;
    console.log(`${req.method} ${req.path} ${res.statusCode} - ${duration}ms`);
  });
  
  next();
};
```

Apply:
```javascript
app.use(requestLogger);
```

### B∆∞·ªõc 5: Error Handling

**Update** `backend/src/index.js` error handler:

```javascript
app.use((err, req, res, next) => {
  // Log error
  console.error('Error:', err);
  
  // Clerk authentication errors
  if (err.message?.includes('Clerk')) {
    return res.status(401).json({ 
      message: 'Authentication failed', 
      error: process.env.NODE_ENV === 'development' ? err.message : undefined 
    });
  }
  
  // General errors
  res.status(err.status || 500).json({ 
    message: process.env.NODE_ENV === 'production' 
      ? 'Internal server error' 
      : err.message,
    stack: process.env.NODE_ENV === 'development' ? err.stack : undefined
  });
});
```

---

## üß™ TESTING & VERIFICATION

### Test 1: Ki·ªÉm tra Token Lifetime

```javascript
// Th√™m v√†o frontend/src/providers/AuthProvider.tsx ƒë·ªÉ debug
useEffect(() => {
  const testToken = async () => {
    const token = await getToken({ template: 'default' });
    
    if (token) {
      // Decode JWT ƒë·ªÉ xem expiry time
      const payload = JSON.parse(atob(token.split('.')[1]));
      const expiryDate = new Date(payload.exp * 1000);
      const now = new Date();
      const minutesUntilExpiry = (expiryDate - now) / 1000 / 60;
      
      console.log('üîç Token Debug:');
      console.log('Expires at:', expiryDate.toLocaleString());
      console.log('Minutes until expiry:', minutesUntilExpiry.toFixed(2));
    }
  };
  
  testToken();
}, [getToken]);
```

N·∫øu c·∫•u h√¨nh ƒë√∫ng, b·∫°n s·∫Ω th·∫•y:
```
üîç Token Debug:
Expires at: [th·ªùi gian sau 1 gi·ªù]
Minutes until expiry: 60.00
```

### Test 2: Test Token Refresh

1. ƒêƒÉng nh·∫≠p v√†o app
2. M·ªü DevTools ‚Üí Console
3. ƒê·ª£i 61 gi√¢y (n·∫øu token lifetime = 60s)
4. Th·ª±c hi·ªán action g·ªçi API
5. Xem console log:
   ```
   üîÑ [Axios] Token expired, refreshing...
   ‚úÖ [Axios] Token refreshed successfully
   ```

### Test 3: Test Multi-device

1. ƒêƒÉng nh·∫≠p tr√™n Chrome
2. ƒêƒÉng nh·∫≠p c√πng account tr√™n Firefox
3. C·∫£ 2 tr√¨nh duy·ªát ph·∫£i ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng

---

## üö® TROUBLESHOOTING

### L·ªói 1: "Missing Clerk Publishable Key"

**Nguy√™n nh√¢n:** Kh√¥ng c√≥ VITE_CLERK_PUBLISHABLE_KEY trong `.env`

**Gi·∫£i ph√°p:**
```bash
# frontend/.env
VITE_CLERK_PUBLISHABLE_KEY=pk_test_xxxxx
```

Restart dev server:
```bash
npm run dev
```

### L·ªói 2: Token v·∫´n expire sau 60 gi√¢y

**Checklist:**
- ‚úÖ ƒê√£ t·∫°o JWT Template?
- ‚úÖ ƒê√£ set Token Lifetime = 3600?
- ‚úÖ ƒê√£ apply template trong API Keys?
- ‚úÖ C√≥ g·ªçi `getToken({ template: 'default' })`?

**Debug:**
```javascript
// Check token expiry
const token = await getToken({ template: 'default' });
const payload = JSON.parse(atob(token.split('.')[1]));
console.log('Expires in seconds:', payload.exp - Math.floor(Date.now() / 1000));
```

N·∫øu k·∫øt qu·∫£ < 3600, JWT template ch∆∞a apply ƒë√∫ng.

### L·ªói 3: CORS errors

**Gi·∫£i ph√°p:**
1. Check **Allowed origins** trong Clerk Dashboard
2. Update backend CORS:
   ```javascript
   app.use(cors({
     origin: ['http://localhost:3000', 'https://yourdomain.com'],
     credentials: true,
   }));
   ```

### L·ªói 4: 401 Unauthorized li√™n t·ª•c

**Debug steps:**

1. Check token trong browser:
   ```javascript
   // DevTools Console
   localStorage.getItem('__clerk_session_token')
   ```

2. Check Authorization header:
   ```javascript
   console.log(axiosInstance.defaults.headers.common['Authorization']);
   ```

3. Check backend middleware order:
   ```javascript
   // ƒê√∫ng:
   app.use(express.json());
   app.use(clerkMiddleware());
   app.use('/api/users', userRoutes);
   ```

### L·ªói 5: "Invalid token signature"

**Nguy√™n nh√¢n:** Mismatch gi·ªØa frontend v√† backend keys

**Gi·∫£i ph√°p:**
- ƒê·∫£m b·∫£o frontend v√† backend d√πng c√πng `CLERK_PUBLISHABLE_KEY`
- Check kh√¥ng nh·∫ßm l·∫´n gi·ªØa test/production keys

---

## üìö T√ÄI LI·ªÜU THAM KH·∫¢O

- **Clerk Documentation:** https://clerk.com/docs
- **JWT Template Guide:** https://clerk.com/docs/backend-requests/making/jwt-templates
- **React SDK:** https://clerk.com/docs/references/react/overview
- **Express SDK:** https://clerk.com/docs/references/backend/overview

---

## ‚úÖ CHECKLIST HO√ÄN TH√ÄNH

ƒê√°nh d·∫•u ‚úÖ khi ho√†n th√†nh:

### C∆° b·∫£n:
- [ ] T·∫°o t√†i kho·∫£n Clerk
- [ ] T·∫°o Application
- [ ] Copy API Keys
- [ ] T·∫°o file .env (frontend + backend)
- [ ] Test ƒëƒÉng nh·∫≠p th√†nh c√¥ng

### N√¢ng cao:
- [ ] T·∫°o JWT Template v·ªõi lifetime >= 3600s
- [ ] Apply JWT Template v√†o API Keys
- [ ] C·∫•u h√¨nh Session settings
- [ ] C·∫•u h√¨nh Allowed Origins
- [ ] Test token kh√¥ng expire sau 60s

### Production:
- [ ] Chuy·ªÉn sang Production keys
- [ ] Setup Google OAuth production
- [ ] Implement rate limiting
- [ ] Add security headers
- [ ] Setup monitoring

---

## üéØ K·∫æT LU·∫¨N

Sau khi ho√†n th√†nh h∆∞·ªõng d·∫´n n√†y:

‚úÖ Token s·∫Ω live √≠t nh·∫•t 1 gi·ªù (ho·∫∑c custom lifetime c·ªßa b·∫°n)
‚úÖ Token t·ª± ƒë·ªông refresh khi h·∫øt h·∫°n
‚úÖ Kh√¥ng b·ªã logout gi·ªØa ch·ª´ng
‚úÖ Multi-device login ho·∫°t ƒë·ªông t·ªët
‚úÖ Production-ready v·ªõi security t·ªët

**N·∫øu g·∫∑p v·∫•n ƒë·ªÅ g√¨, h√£y:**
1. Check l·∫°i t·ª´ng b∆∞·ªõc trong Checklist
2. Xem ph·∫ßn Troubleshooting
3. Check Console logs (c·∫£ frontend v√† backend)
4. Verify JWT token lifetime b·∫±ng debug code

Ch√∫c b·∫°n setup th√†nh c√¥ng! üöÄ

